---
title: "Run an R script as a background job"
description: |
  When working with R you may want to run a script that require quite a long time to complete. 
  As modern computers generally have more cores and ram than required this is not going to be a problem in terms of computer resources.
  Nevertheless, the script will take your R prompt busy preventing you from any other activity. 
  Function `rstudioapi::jobRunScript()` allows you avoid this problem. 

author:
  - name: Andrea Spano
    url: andreaspano.github.io
    affiliation: Quantide
    affiliation_url: www.quantide.com
date: "`r Sys.Date()`"
bibliography: 
  biblio.bib
output:
  distill::distill_article:
    self_contained: false
editor_options: 
  chunk_output_type: console
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

When working with R you may want to run a script that require quite a long time to complete. 

As a basic non sense example consider:

```{r, eval = FALSE}
n <- 1200
y <- numeric(n)
for ( i in seq_len(n)){
  y[[i]] <- i 
  Sys.sleep(3)
}
sum(y)
```

This script, say `wait-for-me.R` when executed takes about one hour. 

If executed directly from the R console it will keep your R session busy for one hour preventing you to keep working on you current R session. 

In order to avoid this waste of time you can use the function `jobRunScript()` from package `rstudioapi` [@rstudioapi]

```{r,  eval = FALSE}
require(rstudioapi)
jobRunScript(path = './wait-for-me.R', 
             name = 'wait for me',
             encoding = "unknown", 
             workingDir = NULL,
             importEnv = FALSE, 
             exportEnv = "R_GlobalEnv")
```

This command tells R to run your script and export the objects created within this environment  

As stated by the function help:

* __path__: The path to the R script to be run.

* __name__: A name for the background job. When NULL (the default), the filename of the script is used as the job name.

* __encoding__: The text encoding of the script, if known.

* __workingDir__: The working directory in which to run the job. When NULL (the default), the parent directory of the R script is used.

* __importEnv__: Whether to import the global environment into the job.

* __exportEnv__: The name of the environment in which to export the R objects created by the job. Use "" (the default) to skip export, "R_GlobalEnv"' to export to the global environment, or the name of an environment object to create an object with that name.

Therefore, if you want to run a job a collect the results back in your working environmentyou need to set exportEnv = "R_GlobalEnv"

In case you need to pass any object from your global environmemnt to teh script you may want to use importEnv = TRUE. Personally, I woulkd not reccomend this choice. A script would be better to be seft contained and not to depend to objects created elsewhere. 





